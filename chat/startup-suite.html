<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StartupSuite – AI Team Platform</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif; 
      background: #fafafa; 
      min-height: 100vh; 
      overflow-x: hidden;
      letter-spacing: -0.01em;
    }
    .app-container { display: flex; min-height: 100vh; }

    /* Sidebar */
    .sidebar { 
      width: 280px; 
      background: rgba(255, 255, 255, 0.8); 
      backdrop-filter: blur(20px);
      border-right: 1px solid rgba(0, 0, 0, 0.06); 
      padding: 24px 0; 
      overflow-y: auto; 
    }
    .sidebar-header { 
      padding: 0 24px 24px; 
      border-bottom: 1px solid rgba(0, 0, 0, 0.06); 
      margin-bottom: 24px; 
    }
    .sidebar-header h2 { 
      font-size: 1.1rem; 
      color: #1d1d1f; 
      margin-bottom: 5px; 
      font-weight: 600;
      letter-spacing: -0.02em;
    }
    .sidebar-nav { padding: 0 16px; }
    .nav-item { 
      display: flex; 
      align-items: center; 
      padding: 10px 12px; 
      margin: 2px 0; 
      border-radius: 6px; 
      cursor: pointer; 
      transition: all 0.15s ease; 
      color: #86868b; 
      font-size: 0.875rem;
      font-weight: 400;
    }
    .nav-item:hover { background: rgba(0, 0, 0, 0.04); color: #1d1d1f; }
    .nav-item.active { background: #007aff; color: white; }

    .persona-list { margin-top: 24px; padding: 0 16px; }
    .persona-sidebar-item { 
      display: flex; 
      align-items: center; 
      padding: 12px 12px; 
      margin: 2px 0; 
      border-radius: 8px; 
      cursor: pointer; 
      transition: all 0.15s ease; 
      position: relative; 
    }
    .persona-sidebar-item:hover { background: rgba(0, 0, 0, 0.04); }
    .persona-sidebar-item.active { background: #007aff; }
    .persona-sidebar-item.active .persona-name,
    .persona-sidebar-item.active .persona-status { color: white; }
    .persona-avatar { 
      width: 28px; 
      height: 28px; 
      border-radius: 6px; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      color: white; 
      font-weight: 600; 
      font-size: 0.75rem; 
      margin-right: 12px; 
    }
    .persona-info { flex: 1; }
    .persona-name { 
      font-size: 0.875rem; 
      font-weight: 500; 
      color: #1d1d1f; 
      margin-bottom: 2px; 
      letter-spacing: -0.01em;
    }
    .persona-status { 
      font-size: 0.75rem; 
      color: #86868b; 
    }
    .status-indicator { 
      width: 6px; 
      height: 6px; 
      border-radius: 50%; 
      position: absolute; 
      top: 10px; 
      right: 10px; 
    }
    .status-working { background: #ff9500; }
    .status-complete { background: #30d158; }
    .status-waiting { background: #ff3b30; }
    .status-idle { background: #8e8e93; }

    /* Main */
    .main-content { flex: 1; display: flex; flex-direction: column; }
    .top-header { 
      background: rgba(255, 255, 255, 0.8); 
      backdrop-filter: blur(20px);
      color: #1d1d1f; 
      padding: 20px 32px; 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    }
    .top-header h1 { 
      font-size: 1.375rem; 
      font-weight: 600; 
      letter-spacing: -0.02em;
    }
    .header-toolbar { display: flex; align-items: center; gap: 16px; }
    .toolbar-group { 
      display: flex; 
      align-items: center; 
      gap: 8px; 
      background: rgba(0, 0, 0, 0.04); 
      border: 1px solid rgba(0, 0, 0, 0.06); 
      padding: 8px 12px; 
      border-radius: 8px; 
    }
    .toolbar-label { 
      font-size: 0.75rem; 
      color: #86868b; 
      font-weight: 500;
    }
    .toolbar-chips { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
    .toolbar-chip { 
      background: #f5f5f7; 
      color: #1d1d1f; 
      border: 1px solid rgba(0, 0, 0, 0.06); 
      padding: 4px 10px; 
      border-radius: 6px; 
      font-size: 0.75rem; 
      cursor: pointer; 
      font-weight: 500;
      transition: all 0.15s ease;
    }
    .toolbar-chip:hover { background: #e5e5e7; }
    .project-selector { 
      background: #f5f5f7; 
      border: 1px solid rgba(0, 0, 0, 0.06); 
      color: #1d1d1f; 
      padding: 8px 12px; 
      border-radius: 6px; 
      font-size: 0.875rem; 
      cursor: pointer; 
      min-width: 150px;
      font-weight: 500;
    }
    .project-selector option { background: white; color: #1d1d1f; }
    .header-btn { 
      background: #007aff; 
      border: none; 
      color: white; 
      padding: 8px 16px; 
      border-radius: 6px; 
      font-size: 0.875rem; 
      cursor: pointer; 
      transition: all 0.15s ease; 
      font-weight: 500;
    }
    .header-btn:hover { background: #0056cc; }

    .content-area { 
      flex: 1; 
      padding: 32px; 
      overflow-y: auto; 
    }
    .view-container { 
      background: rgba(255, 255, 255, 0.8); 
      backdrop-filter: blur(20px);
      border-radius: 16px; 
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04), 0 8px 24px rgba(0, 0, 0, 0.06); 
      min-height: calc(100vh - 160px);
      border: 1px solid rgba(0, 0, 0, 0.06);
    }
    .view { display: none; padding: 32px; }
    .view.active { display: block; }

    .welcome-section { 
      text-align: center; 
      padding: 80px 40px; 
    }
    .welcome-section h2 { 
      color: #1d1d1f; 
      font-size: 2.25rem; 
      font-weight: 600; 
      margin-bottom: 16px; 
      letter-spacing: -0.03em;
    }
    .welcome-section p { 
      font-size: 1.125rem; 
      color: #86868b; 
      margin-bottom: 32px; 
      line-height: 1.5;
    }

    .team-selection { 
      margin: 48px 0; 
    }
    
    .team-selection h3 {
      color: #1d1d1f;
      font-size: 1.5rem;
      font-weight: 600;
      letter-spacing: -0.02em;
      margin-bottom: 8px;
    }
    
    .team-selection > p {
      color: #86868b;
      font-size: 1rem;
      margin-bottom: 32px;
    }
    .personas-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
      gap: 20px; 
      margin: 32px 0; 
    }
    .persona-card { 
      border: 1px solid rgba(0, 0, 0, 0.06); 
      border-radius: 16px; 
      padding: 24px; 
      text-align: center; 
      cursor: pointer; 
      background: rgba(255, 255, 255, 0.8); 
      backdrop-filter: blur(20px);
      transition: all 0.15s ease; 
    }
    .persona-card:hover { 
      border-color: #007aff; 
      transform: translateY(-1px); 
      box-shadow: 0 8px 24px rgba(0, 122, 255, 0.12); 
    }
    .persona-card.selected { 
      border-color: #007aff; 
      background: rgba(0, 122, 255, 0.05); 
      box-shadow: 0 4px 16px rgba(0, 122, 255, 0.1);
    }
    .persona-card h4 { 
      color: #1d1d1f; 
      font-size: 1.125rem; 
      font-weight: 600; 
      margin-bottom: 8px; 
      letter-spacing: -0.02em;
    }
    .persona-card p { 
      color: #86868b; 
      font-size: 0.875rem; 
      line-height: 1.5; 
    }

    .btn { 
      background: #007aff; 
      color: white; 
      border: none; 
      padding: 10px 20px; 
      border-radius: 8px; 
      font-size: 0.875rem; 
      cursor: pointer; 
      transition: all 0.15s ease; 
      font-weight: 500;
      letter-spacing: -0.01em;
    }
    .btn:hover { background: #0056cc; }
    .btn:disabled { 
      background: #d1d1d6; 
      cursor: not-allowed; 
      color: #86868b;
    }
    .btn-secondary { 
      background: #8e8e93; 
      color: white;
    }
    .btn-secondary:hover { background: #6d6d70; }
    .btn-success { 
      background: #30d158; 
      color: white;
    }
    .btn-success:hover { background: #28cd4f; }

    /* Progress */
    .progress-overview { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); 
      gap: 20px; 
      margin: 20px 0 32px; 
    }
    .progress-card { 
      background: rgba(255, 255, 255, 0.8); 
      backdrop-filter: blur(20px);
      border: 1px solid rgba(0, 0, 0, 0.06); 
      border-radius: 16px; 
      padding: 20px; 
      cursor: pointer; 
      transition: all 0.15s ease; 
      position: relative; 
    }
    .progress-card:hover { 
      border-color: #007aff; 
      box-shadow: 0 8px 24px rgba(0, 122, 255, 0.12); 
      transform: translateY(-1px);
    }
    .progress-card-header { 
      display: flex; 
      align-items: center; 
      gap: 12px; 
      margin-bottom: 16px; 
    }
    .progress-card h4 { 
      color: #1d1d1f; 
      font-size: 1rem; 
      font-weight: 600; 
      margin: 0; 
      letter-spacing: -0.01em;
    }
    .progress-percentage { 
      color: #86868b; 
      font-size: 0.875rem; 
      margin-left: auto; 
      font-weight: 500;
    }
    .progress-bar { 
      background: rgba(0, 0, 0, 0.06); 
      height: 6px; 
      border-radius: 3px; 
      overflow: hidden; 
    }
    .progress-fill { 
      background: #007aff; 
      height: 100%; 
      transition: width 0.3s ease; 
    }

    /* Chat Interface */
    .chat-interface { 
      background: rgba(255, 255, 255, 0.6); 
      border-radius: 12px; 
      padding: 0; 
      margin: 0; 
      border: 1px solid rgba(0, 0, 0, 0.06);
    }
    
    /* Chat Header */
    .chat-header {
      padding: 20px 24px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
      background: rgba(255, 255, 255, 0.8);
      border-radius: 12px 12px 0 0;
    }
    
    .team-info { 
      display: none; /* Hidden by default, will be shown in organized way */
    }
    
    .chat-controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    
    .persona-selector {
      position: relative;
    }
    
    .current-persona {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #f5f5f7;
      border: 1px solid rgba(0, 0, 0, 0.06);
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s ease;
      font-size: 0.875rem;
      font-weight: 500;
      color: #1d1d1f;
      min-width: 160px;
    }
    
    .current-persona:hover {
      background: #e5e5e7;
    }
    
    .dropdown-arrow {
      margin-left: auto;
      font-size: 0.75rem;
      color: #86868b;
      transition: transform 0.15s ease;
    }
    
    .current-persona.open .dropdown-arrow {
      transform: rotate(180deg);
    }
    
    .persona-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid rgba(0, 0, 0, 0.06);
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
      z-index: 100;
      margin-top: 4px;
      overflow: hidden;
    }
    
    .persona-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      cursor: pointer;
      transition: all 0.15s ease;
      font-size: 0.875rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.04);
    }
    
    .persona-option:last-child {
      border-bottom: none;
    }
    
    .persona-option:hover {
      background: rgba(0, 0, 0, 0.04);
    }
    
    .persona-option.active {
      background: #007aff;
      color: white;
    }
    
    .persona-option .persona-avatar {
      width: 20px;
      height: 20px;
      font-size: 0.65rem;
      margin-right: 0;
    }
    
    .chat-actions {
      display: flex;
      gap: 8px;
    }
    
    .action-btn {
      background: transparent;
      border: 1px solid rgba(0, 0, 0, 0.1);
      color: #86868b;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.15s ease;
      font-weight: 500;
    }
    
    .action-btn:hover { 
      background: rgba(0, 0, 0, 0.04); 
      color: #1d1d1f; 
    }
    
    .action-btn.danger:hover {
      background: #ff3b30;
      color: white;
      border-color: #ff3b30;
    }
    
    .chip-row { display: flex; gap: 8px; flex-wrap: wrap; }
    .chip { background: #007aff; color: white; padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; font-weight: 500; }
    .chip.secondary { background: #8e8e93; }
    
    .chat-messages { 
      max-height: 420px; 
      overflow-y: auto; 
      background: transparent; 
      padding: 24px; 
      margin: 0; 
      border: none; 
    }
    
    .message { 
      margin-bottom: 16px; 
      padding: 16px 20px; 
      border-radius: 12px; 
      max-width: 80%;
    }
    .message.user { 
      background: #007aff; 
      color: white;
      margin-left: auto; 
      margin-right: 0;
    }
    .message.ai { 
      background: #f5f5f7; 
      color: #1d1d1f;
      margin-right: auto;
      margin-left: 0;
    }
    .message.system { 
      background: rgba(142, 142, 147, 0.1); 
      text-align: center; 
      font-style: italic; 
      color: #86868b;
      max-width: 100%;
      margin: 0 auto 16px auto;
    }
    .message-header { 
      font-weight: 600; 
      margin-bottom: 8px; 
      font-size: 0.875rem;
      opacity: 0.8;
    }
    .message p { margin-bottom: 8px; line-height: 1.5; }
    .message code { 
      background: rgba(0, 0, 0, 0.06); 
      padding: 2px 6px; 
      border-radius: 4px; 
      font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace; 
      font-size: 0.875em; 
    }
    .message strong { font-weight: 600; }
    .message em { font-style: italic; }
    
    .input-section { 
      display: flex; 
      gap: 12px; 
      padding: 20px 24px;
      background: rgba(255, 255, 255, 0.8);
      border-top: 1px solid rgba(0, 0, 0, 0.06);
      border-radius: 0 0 12px 12px;
    }
    .input-section textarea { 
      flex: 1; 
      padding: 12px 16px; 
      border: 1px solid rgba(0, 0, 0, 0.1); 
      border-radius: 8px; 
      font-family: inherit; 
      font-size: 0.875rem; 
      resize: vertical; 
      min-height: 44px;
      background: rgba(255, 255, 255, 0.8);
      transition: all 0.15s ease;
    }
    .input-section textarea:focus { 
      outline: none; 
      border-color: #007aff; 
      background: white;
    }
    
    /* Broadcast Mode */
    .broadcast-indicator {
      background: rgba(255, 149, 0, 0.1);
      border: 1px solid rgba(255, 149, 0, 0.3);
      border-radius: 8px;
      padding: 8px 12px;
      margin-bottom: 8px;
      text-align: center;
    }
    
    /* Interrupt Controls */
    .interrupt-controls {
      display: none;
      background: rgba(255, 59, 48, 0.1);
      border: 1px solid rgba(255, 59, 48, 0.3);
      border-radius: 12px;
      padding: 16px;
      margin: 16px 24px;
    }
    
    .interrupt-controls h4 {
      color: #d70015;
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 12px;
    }
    
    .interrupt-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .interrupt-btn {
      background: transparent;
      border: 1px solid rgba(255, 59, 48, 0.3);
      color: #d70015;
      padding: 8px 16px;
      border-radius: 6px;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.15s ease;
      font-weight: 500;
    }
    
    .interrupt-btn:hover {
      background: #ff3b30;
      color: white;
    }

    /* Persona individual */
    .persona-view { padding: 0; }
    .persona-header { 
      background: rgba(255, 255, 255, 0.8); 
      backdrop-filter: blur(20px);
      padding: 24px 32px; 
      border-bottom: 1px solid rgba(0, 0, 0, 0.06); 
      display: flex; 
      align-items: center; 
      gap: 16px; 
    }
    .persona-header .persona-avatar { 
      width: 48px; 
      height: 48px; 
      font-size: 1.125rem; 
      border-radius: 8px;
    }
    .persona-details h3 { 
      color: #1d1d1f; 
      font-size: 1.25rem; 
      font-weight: 600; 
      margin-bottom: 4px; 
      letter-spacing: -0.02em;
    }
    .persona-details p { 
      color: #86868b; 
      font-size: 0.875rem; 
    }
    .persona-header-actions {
      display: flex;
      gap: 8px;
    }
    .persona-content { padding: 32px; }
    .persona-thinking { 
      background: rgba(0, 122, 255, 0.05); 
      border: 1px solid rgba(0, 122, 255, 0.15); 
      border-radius: 12px; 
      padding: 20px; 
      margin-bottom: 24px; 
    }
    .persona-thinking h4 { 
      color: #007aff; 
      font-size: 0.75rem; 
      font-weight: 600; 
      text-transform: uppercase; 
      letter-spacing: 0.05em; 
      margin-bottom: 12px; 
    }
    .thinking-content { 
      color: #1d1d1f; 
      line-height: 1.5; 
      font-size: 0.875rem; 
    }
    .deliverables-section { margin-top: 24px; }
    .deliverables-section h4 { 
      color: #1d1d1f; 
      font-size: 1rem; 
      font-weight: 600; 
      margin-bottom: 16px; 
      letter-spacing: -0.01em;
    }
    .deliverable-item { 
      background: rgba(255, 255, 255, 0.8); 
      backdrop-filter: blur(20px);
      border: 1px solid rgba(0, 0, 0, 0.06); 
      border-radius: 12px; 
      padding: 16px; 
      margin-bottom: 12px; 
      cursor: pointer; 
      transition: all 0.15s ease; 
    }
    .deliverable-item:hover { 
      border-color: #007aff; 
      box-shadow: 0 4px 16px rgba(0, 122, 255, 0.1); 
      transform: translateY(-1px);
    }
    .deliverable-item h5 { 
      color: #1d1d1f; 
      font-size: 0.875rem; 
      font-weight: 600; 
      margin-bottom: 6px; 
      letter-spacing: -0.01em;
    }
    .deliverable-item p { 
      color: #86868b; 
      font-size: 0.75rem; 
      line-height: 1.4; 
    }
    
    /* Deliverable Modal */
    .deliverable-modal { 
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%; 
      background: rgba(0, 0, 0, 0.4); 
      backdrop-filter: blur(10px);
      display: none; 
      z-index: 1000; 
      align-items: center;
      justify-content: center;
    }
    .deliverable-content { 
      background: white; 
      border-radius: 16px; 
      padding: 32px; 
      max-width: 800px; 
      width: 90%;
      max-height: 80vh; 
      overflow-y: auto; 
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
      position: relative;
    }
    .deliverable-content h3 { 
      color: #1d1d1f; 
      margin-bottom: 20px; 
      font-size: 1.25rem;
      font-weight: 600;
      letter-spacing: -0.02em;
      padding-right: 40px;
    }
    .deliverable-content h4 { 
      color: #1d1d1f; 
      margin: 24px 0 12px 0; 
      font-size: 1rem;
      font-weight: 600;
      letter-spacing: -0.01em;
    }
    .deliverable-content p { 
      color: #1d1d1f; 
      line-height: 1.6; 
      margin-bottom: 12px; 
      font-size: 0.875rem;
    }
    .deliverable-content ul { 
      margin: 12px 0 16px 20px; 
    }
    .deliverable-content li { 
      color: #1d1d1f; 
      margin-bottom: 8px; 
      font-size: 0.875rem;
      line-height: 1.5;
    }

    @media (max-width: 768px) {
      .app-container { flex-direction: column; }
      .sidebar { 
        width: 100%; 
        height: auto; 
        border-right: none;
        border-bottom: 1px solid rgba(0, 0, 0, 0.06);
      }
      .content-area { padding: 20px; }
      .view { padding: 24px; }
      .personas-grid { grid-template-columns: 1fr; }
      .progress-overview { grid-template-columns: 1fr; }
      .input-section { flex-direction: column; }
      .message { max-width: 95%; }
      .chat-controls { 
        flex-direction: column; 
        gap: 12px; 
        align-items: stretch; 
      }
      .active-personas { justify-content: center; }
      .chat-actions { justify-content: center; }
      .persona-header { 
        flex-direction: column; 
        text-align: center; 
        gap: 12px; 
        padding: 20px;
      }
      .persona-header-actions { margin-top: 8px; }
      .broadcast-content { padding: 24px; }
      .persona-checkboxes { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h2>StartupSuite</h2>
        <p style="color: #6b7280; font-size: 0.8rem;">AI Team Platform</p>
      </div>
      <div class="sidebar-nav">
        <div class="nav-item active" data-view="overview">📊 Dashboard</div>
        <div class="nav-item" data-view="chat">💬 Executive Chat</div>
      </div>
      <div class="persona-list" id="persona-sidebar"></div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="top-header">
        <h1 id="view-title">Dashboard</h1>
        <div class="header-toolbar">
          <div class="toolbar-group">
            <span class="toolbar-label">Project</span>
            <select id="project-selector" class="project-selector">
              <option value="">Select Project...</option>
              <option value="new">+ New Project</option>
            </select>
          </div>
          <div class="toolbar-group">
            <span class="toolbar-label">Instances</span>
            <div class="toolbar-chips" id="toolbar-instances"></div>
          </div>
          <div class="toolbar-group">
            <span class="toolbar-label">Tasks</span>
            <div class="toolbar-chips" id="toolbar-tasks"></div>
          </div>
          <div style="flex:1 1 auto"></div>
          <button class="header-btn" id="btn-settings">Settings</button>
        </div>
      </div>

      <div class="content-area">
        <div class="view-container">
          <!-- Overview -->
          <div class="view active" id="overview-view">
            <div class="welcome-section" id="welcome-section">
              <h2>Welcome to StartupSuite!</h2>
              <p>Get started by creating a new project and assembling your AI team.</p>
              <div style="text-align:center; margin-top: 20px;">
                <button class="btn" id="btn-start-project">Assemble Your Team</button>
              </div>
            </div>
            <div class="project-section" id="project-section" style="display:none;">
              <h2 style="text-align:center; color:#1f2937; margin-bottom: 15px;">Project Dashboard</h2>
              <div style="text-align:center; margin-bottom: 30px;">
                <button class="btn btn-secondary" id="btn-update-team">Update Your Team</button>
                <button class="btn" id="btn-continue-chat" style="margin-left: 10px;">Continue Working</button>
              </div>
            </div>
            <div id="progress-overview-section" style="display:none;">
              <h3 style="color:#1f2937; margin-bottom: 10px;">Project Progress</h3>
              <div class="progress-overview" id="progress-overview"></div>
            </div>
          </div>

          <!-- Setup -->
          <div class="view" id="setup-view">
            <div class="team-selection">
              <h3 style="text-align:center;">Choose Your Team</h3>
              <p style="text-align:center; color:#6b7280; margin-bottom: 20px;">Select the AI personas you want on your team:</p>
              <div class="personas-grid" id="setup-personas-grid"></div>
              <div style="text-align:center; margin-top: 20px;">
                <button class="btn" id="proceed-to-chat" disabled>Start Working</button>
              </div>
            </div>
          </div>

          <!-- Executive Chat -->
          <div class="view" id="chat-view">
            <div class="chat-interface">
              <div class="chat-header">
                <div class="chat-controls">
                  <div class="persona-selector">
                    <div class="current-persona" id="current-persona-display" onclick="togglePersonaDropdown()">
                      <span id="current-persona-name">Executive Chat</span>
                      <span class="dropdown-arrow">▼</span>
                    </div>
                    <div class="persona-dropdown" id="persona-dropdown" style="display: none;">
                      <!-- Persona options will be rendered here -->
                    </div>
                  </div>
                  <div class="chat-actions">
                    <button class="action-btn" id="btn-broadcast-mode" title="Toggle broadcast mode">
                      <span>📢</span> <span id="broadcast-mode-text">Broadcast</span>
                    </button>
                    <button class="action-btn danger" id="btn-interrupt" title="Interrupt current work">
                      <span>⏸️</span> Interrupt
                    </button>
                    <button class="action-btn" id="btn-reset-chat" title="Reset conversation">
                      <span>🔄</span> Reset
                    </button>
                  </div>
                </div>
              </div>
              
              <div class="chat-messages" id="chat-messages">
                <div class="message system">
                  <div class="message-header">System</div>
                  Team initialized. Ready to receive your executive idea.
                </div>
              </div>
              
              <div class="input-section">
                <div class="broadcast-indicator" id="broadcast-indicator" style="display: none;">
                  <span style="font-size: 0.75rem; color: #ff9500; font-weight: 500;">📢 Broadcast Mode - Message will be sent to all selected personas</span>
                </div>
                <textarea id="executive-input" placeholder="Describe your idea or project..."></textarea>
                <button class="btn" id="btn-send">Send</button>
              </div>
              
              <div id="action-plan-section" style="display:none; margin: 24px;">
                <div class="action-plan" style="background: rgba(255, 204, 0, 0.1); border: 1px solid rgba(255, 204, 0, 0.3); border-radius: 12px; padding: 20px;">
                  <h4 style="color: #bf8f00; margin-bottom: 12px; font-weight: 600;">Executive Action Plan</h4>
                  <div id="action-plan-content"></div>
                  <div style="text-align: center; margin-top: 16px; display: flex; gap: 12px; justify-content: center;">
                    <button class="btn btn-secondary" id="btn-refine">Refine Plan</button>
                    <button class="btn btn-success" id="btn-approve">Give Green Light</button>
                  </div>
                </div>
              </div>
              
              <!-- Interrupt Controls -->
              <div class="interrupt-controls" id="interrupt-controls">
                <h4>⏸️ Work Interrupted</h4>
                <p style="font-size: 0.875rem; color: #86868b; margin-bottom: 12px;">
                  Choose how to proceed with the current workflow:
                </p>
                <div class="interrupt-actions">
                  <button class="interrupt-btn" onclick="resumeWork()">Resume Work</button>
                  <button class="interrupt-btn" onclick="modifyAndResend()">Modify & Resend</button>
                  <button class="interrupt-btn" onclick="resetWorkflow()">Reset Workflow</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Persona detail views -->
          <div id="persona-views"></div>
        </div>
      </div>
    </div>
  </div>



  <!-- Deliverable Modal -->
  <div class="deliverable-modal" id="deliverable-modal">
    <div class="deliverable-content">
      <button class="close-btn" onclick="closeDeliverableModal()">&times;</button>
      <h3 id="deliverable-title">Deliverable Title</h3>
      <div id="deliverable-body">Deliverable content will appear here...</div>
    </div>
  </div>
  


  <script>
    // Personas configuration
    const personas = {
      'executive': { name: 'Executive', description: 'Strategic vision and oversight', color: '#5856d6', shortName: 'EX' },
      'product-manager': { name: 'Product Manager', description: 'Market research and requirements', color: '#007aff', shortName: 'PM' },
      'solution-architect': { name: 'Solution Architect', description: 'Technical design and architecture', color: '#30d158', shortName: 'SA' },
      'program-manager': { name: 'Program Manager', description: 'Project planning and task management', color: '#ff9500', shortName: 'PGM' },
      'design-buddy': { name: 'Design Buddy', description: 'User experience and design', color: '#ff2d92', shortName: 'DB' }
    };

    // State
    let selectedPersonas = [];
    let currentView = 'overview';
    let currentProject = null; // {id, name, personas, created}
    let projects = []; // Array of saved projects
    const personaStates = {};
    const instances = []; // {id, personaId, name}
    const tasks = []; // {id, personaId, title}
    let currentActivePersona = null; // Currently selected persona for chat
    let workflowInterrupted = false;
    let workflowTimers = {}; // Store active timers for interruption
    let broadcastMode = false; // Whether we're in broadcast mode

    Object.keys(personas).forEach(id => {
      personaStates[id] = { status: 'idle', thinking: 'Ready to contribute to the project...', progress: 0, dependencies: [], deliverables: [] };
    });

    // Utilities
    function byId(id) { return document.getElementById(id); }
    function addMessage(sender, content, type='ai') {
      const chatMessages = byId('chat-messages');
      const message = document.createElement('div');
      message.className = `message ${type}`;
      message.innerHTML = `<div class="message-header">${sender}</div>${content}`;
      chatMessages.appendChild(message); chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    function addPersonaMessage(personaId, sender, content, type='ai') {
      const chatMessages = byId(`${personaId}-chat-messages`);
      if (!chatMessages) return;
      const message = document.createElement('div');
      message.className = `message ${type}`;
      // Convert markdown-like content to HTML
      const formattedContent = formatMarkdown(content);
      message.innerHTML = `<div class="message-header">${sender}</div>${formattedContent}`;
      chatMessages.appendChild(message); 
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    function formatMarkdown(text) {
      return text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/`(.*?)`/g, '<code style="background:#f1f5f9;padding:2px 4px;border-radius:3px;">$1</code>')
        .replace(/\n\n/g, '</p><p>')
        .replace(/\n/g, '<br>')
        .replace(/^/, '<p>')
        .replace(/$/, '</p>');
    }
    
    function sendPersonaMessage(personaId) {
      // Handle both individual persona inputs and main chat input
      const input = byId(`${personaId}-input`) || byId('executive-input');
      const message = input.value.trim();
      if (!message) return;
      
      // If using main chat, route to current active persona
      const targetPersonaId = personaId || currentActivePersona;
      if (!targetPersonaId) return;
      
      // Add message to both main chat and persona-specific chat
      addMessage('You', message, 'user');
      addPersonaMessage(targetPersonaId, 'You', message, 'user');
      input.value = '';
      
      // Simulate AI response
      setTimeout(() => {
        const responses = {
          'product-manager': `Thank you for your question! As your **Product Manager**, I'm analyzing this from a market perspective.\n\nHere's my initial assessment:\n- Market opportunity analysis\n- User persona definition\n- Competitive landscape review\n\nI'll create a comprehensive *Product Requirements Document* based on this input.`,
          'solution-architect': `Great question! From a **technical architecture** standpoint, I need to consider:\n\n\`System scalability requirements\`\n\`Technology stack selection\`\n\`Integration patterns\`\n\nLet me design the optimal solution architecture for this requirement.`,
          'program-manager': `Excellent! As your **Program Manager**, I'll break this down into actionable tasks:\n\n**Phase 1**: Requirements gathering\n**Phase 2**: Design and architecture\n**Phase 3**: Implementation planning\n\nI'll create a detailed project timeline with milestones.`,
          'design-buddy': `Love this direction! From a **UX/UI perspective**, I'm thinking about:\n\n- User journey mapping\n- Interface wireframes\n- Design system components\n\nI'll create mockups that prioritize *user experience* and visual consistency.`,
          'executive': `Excellent strategic thinking! As your **Executive**, I see the bigger picture:\n\n**Key Strategic Objectives:**\n- Market positioning\n- Resource allocation\n- Risk assessment\n\nThis aligns well with our overall business goals and competitive strategy.`
        };
        
        const response = responses[targetPersonaId] || `Thank you for your input! I'll work on this and provide detailed analysis shortly.`;
        addMessage(personas[targetPersonaId].name, response, 'ai');
        addPersonaMessage(targetPersonaId, personas[targetPersonaId].name, response, 'ai');
      }, 1000 + Math.random() * 2000);
    }

    // Views
    function showView(view) {
      document.querySelectorAll('.nav-item').forEach(i => i.classList.toggle('active', i.dataset.view === view));
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      if (view === 'overview') { 
        byId('overview-view').classList.add('active'); 
        byId('view-title').textContent = currentProject ? 'Project Dashboard' : 'Dashboard'; 
        updateDashboardView();
      }
      if (view === 'setup') { byId('setup-view').classList.add('active'); byId('view-title').textContent = 'Team Setup'; renderSetupGrid(); }
      if (view === 'chat') { byId('chat-view').classList.add('active'); byId('view-title').textContent = 'Executive Chat'; renderSelectedTeam(); }
      currentView = view;
    }

    function updateDashboardView() {
      const welcomeSection = byId('welcome-section');
      const projectSection = byId('project-section');
      
      if (currentProject) {
        welcomeSection.style.display = 'none';
        projectSection.style.display = 'block';
      } else {
        welcomeSection.style.display = 'block';
        projectSection.style.display = 'none';
      }
      updateProgressOverview();
    }

    function renderSidebar() {
      const container = byId('persona-sidebar');
      container.innerHTML = Object.keys(personas).map(pid => {
        const p = personas[pid];
        return `
          <div class="persona-sidebar-item" data-persona="${pid}">
            <div class="persona-avatar" style="background:${p.color};">${p.shortName}</div>
            <div class="persona-info">
              <div class="persona-name">${p.name}</div>
              <div class="persona-status" id="${pid}-status">Ready to work</div>
            </div>
            <div class="status-indicator status-idle" id="${pid}-indicator"></div>
          </div>`;
      }).join('');
      container.querySelectorAll('.persona-sidebar-item').forEach(el => {
        el.addEventListener('click', () => {
          const personaId = el.dataset.persona; showPersonaView(personaId);
        })
      })
    }

    function renderSetupGrid() {
      const grid = byId('setup-personas-grid');
      grid.innerHTML = Object.keys(personas).map(pid => {
        const p = personas[pid];
        const isSelected = selectedPersonas.includes(pid);
        return `
          <div class="persona-card ${isSelected ? 'selected' : ''}" data-persona="${pid}">
            <div class="persona-avatar" style="background:${p.color}; width:48px; height:48px; margin:0 auto 10px; font-size:1.1rem;">${p.shortName}</div>
            <h4>${p.name}</h4>
            <p>${p.description}</p>
          </div>`;
      }).join('');
      grid.querySelectorAll('.persona-card').forEach(card => {
        card.addEventListener('click', () => {
          const pid = card.dataset.persona;
          const idx = selectedPersonas.indexOf(pid);
          if (idx > -1) { selectedPersonas.splice(idx, 1); card.classList.remove('selected'); }
          else { selectedPersonas.push(pid); card.classList.add('selected'); }
          byId('proceed-to-chat').disabled = selectedPersonas.length === 0;
        })
      })
    }

    function renderSelectedTeam() {
      // Update current persona display
      const currentPersonaDisplay = byId('current-persona-name');
      if (currentPersonaDisplay) {
        if (currentActivePersona) {
          currentPersonaDisplay.textContent = personas[currentActivePersona].name;
        } else {
          currentPersonaDisplay.textContent = 'Executive Chat';
        }
      }
      
      // Render persona dropdown options
      const dropdown = byId('persona-dropdown');
      if (dropdown) {
        const options = [
          { id: null, name: 'Executive Chat', description: 'Initial project discussion' },
          ...selectedPersonas.map(pid => ({
            id: pid,
            name: personas[pid].name,
            description: personas[pid].description
          }))
        ];
        
        dropdown.innerHTML = options.map(option => `
          <div class="persona-option ${currentActivePersona === option.id ? 'active' : ''}" 
               onclick="switchToPersona('${option.id}')">
            ${option.id ? `<div class="persona-avatar" style="background:${personas[option.id].color};">${personas[option.id].shortName}</div>` : '<span style="width: 20px; text-align: center;">💼</span>'}
            <div>
              <div style="font-weight: 500;">${option.name}</div>
            </div>
          </div>
        `).join('');
      }
      
      renderToolbar();
      renderLinkedChips();
    }
    
    function togglePersonaDropdown() {
      const dropdown = byId('persona-dropdown');
      const display = byId('current-persona-display');
      const isOpen = dropdown.style.display === 'block';
      
      dropdown.style.display = isOpen ? 'none' : 'block';
      display.classList.toggle('open', !isOpen);
      
      // Close dropdown when clicking outside
      if (!isOpen) {
        setTimeout(() => {
          document.addEventListener('click', closeDropdownOnOutsideClick, { once: true });
        }, 0);
      }
    }
    
    function closeDropdownOnOutsideClick(event) {
      const dropdown = byId('persona-dropdown');
      const display = byId('current-persona-display');
      
      if (!dropdown.contains(event.target) && !display.contains(event.target)) {
        dropdown.style.display = 'none';
        display.classList.remove('open');
      }
    }
    
    function switchToPersona(personaId) {
      currentActivePersona = personaId === 'null' ? null : personaId;
      
      // Close dropdown
      byId('persona-dropdown').style.display = 'none';
      byId('current-persona-display').classList.remove('open');
      
      renderSelectedTeam();
      
      // Update chat messages to show this persona's conversation
      const chatMessages = byId('chat-messages');
      
      if (currentActivePersona) {
        const personaChatMessages = byId(`${currentActivePersona}-chat-messages`);
        
        if (personaChatMessages) {
          chatMessages.innerHTML = personaChatMessages.innerHTML;
        } else {
          chatMessages.innerHTML = `
            <div class="message system">
              <div class="message-header">System</div>
              Now chatting with ${personas[currentActivePersona].name}. Ask follow-up questions or provide additional guidance.
            </div>
          `;
        }
        
        // Update input placeholder
        const input = byId('executive-input');
        input.placeholder = `Ask ${personas[currentActivePersona].name} a follow-up question...`;
      } else {
        // Back to executive chat
        chatMessages.innerHTML = `
          <div class="message system">
            <div class="message-header">System</div>
            Team initialized. Ready to receive your executive idea.
          </div>
        `;
        
        const input = byId('executive-input');
        input.placeholder = 'Describe your idea or project...';
      }
    }
    

    
    function interruptWorkflow() {
      workflowInterrupted = true;
      
      // Stop all active timers
      Object.keys(workflowTimers).forEach(timerId => {
        clearInterval(workflowTimers[timerId]);
        delete workflowTimers[timerId];
      });
      
      // Update all working personas to interrupted state
      selectedPersonas.forEach(pid => {
        if (personaStates[pid].status === 'working') {
          updatePersonaStatus(pid, 'waiting', 'Work interrupted - awaiting new instructions...');
        }
      });
      
      // Show interrupt controls
      byId('interrupt-controls').style.display = 'block';
      
      addMessage('System', '⏸️ Workflow interrupted. All personas have paused their current work.', 'system');
    }
    
    function resumeWork() {
      workflowInterrupted = false;
      byId('interrupt-controls').style.display = 'none';
      
      // Resume workflow from current state
      addMessage('System', '▶️ Workflow resumed. Personas will continue their work.', 'system');
      
      // Restart simulation for working personas
      selectedPersonas.forEach(pid => {
        if (personaStates[pid].status === 'waiting' && personaStates[pid].dependencies.length === 0) {
          updatePersonaStatus(pid, 'working', 'Resuming work...');
          simulatePersonaWork(pid);
        }
      });
    }
    
    function modifyAndResend() {
      workflowInterrupted = false;
      byId('interrupt-controls').style.display = 'none';
      
      // Reset all personas to idle and clear chat
      selectedPersonas.forEach(pid => {
        updatePersonaStatus(pid, 'idle', 'Ready for new instructions...');
        personaStates[pid].progress = 0;
        personaStates[pid].dependencies = [];
      });
      
      // Clear action plan and reset input
      byId('action-plan-section').style.display = 'none';
      byId('executive-input').value = '';
      byId('executive-input').placeholder = 'Describe your revised idea or project...';
      
      addMessage('System', '🔄 Workflow reset. You can now provide new instructions to the team.', 'system');
    }
    
    function toggleBroadcastMode() {
      broadcastMode = !broadcastMode;
      const indicator = byId('broadcast-indicator');
      const modeText = byId('broadcast-mode-text');
      const broadcastBtn = byId('btn-broadcast-mode');
      
      if (broadcastMode) {
        indicator.style.display = 'block';
        modeText.textContent = 'Exit Broadcast';
        broadcastBtn.style.background = '#ff9500';
        broadcastBtn.style.color = 'white';
        
        // Update placeholder
        const input = byId('executive-input');
        input.placeholder = 'Type message to broadcast to all selected personas...';
      } else {
        indicator.style.display = 'none';
        modeText.textContent = 'Broadcast';
        broadcastBtn.style.background = '';
        broadcastBtn.style.color = '';
        
        // Reset placeholder
        updateInputPlaceholder();
      }
    }
    
    function updateInputPlaceholder() {
      const input = byId('executive-input');
      if (currentActivePersona) {
        input.placeholder = `Ask ${personas[currentActivePersona].name} a follow-up question...`;
      } else {
        input.placeholder = 'Describe your idea or project...';
      }
    }
    
    function broadcastMessage(message) {
      // Send to all selected personas
      selectedPersonas.forEach(pid => {
        addPersonaMessage(pid, 'Broadcast Update', message, 'user');
        
        // Simulate persona acknowledging the update
        setTimeout(() => {
          const responses = {
            'product-manager': `Thank you for the update! I'll revise my **Product Requirements Document** and **Market Analysis** to incorporate this new information.`,
            'solution-architect': `Update received! I'll review my **System Architecture** and **Technical Specifications** to account for these changes.`,
            'program-manager': `Noted! I'll update the **Project Timeline** and **Task Breakdown** to reflect these new requirements.`,
            'design-buddy': `Great insight! I'll revise the **User Journey Maps** and **UI Wireframes** based on this update.`,
            'executive': `Excellent strategic update! I'll incorporate this into our **Project Vision** and **Strategic Brief**.`
          };
          
          const response = responses[pid] || `Update acknowledged! I'll revise my deliverables to incorporate this new information.`;
          addPersonaMessage(pid, personas[pid].name, response, 'ai');
        }, 1000 + Math.random() * 2000);
      });
      
      // Show confirmation in main chat
      addMessage('System', `📢 Message broadcasted to all ${selectedPersonas.length} personas`, 'system');
      
      // Exit broadcast mode
      broadcastMode = false;
      toggleBroadcastMode();
    }
    
    function clearPersonaChat(personaId) {
      const chatMessages = byId(`${personaId}-chat-messages`);
      if (chatMessages) {
        chatMessages.innerHTML = `
          <div class="message system">
            <div class="message-header">System</div>
            ${personas[personaId].name} is ready to help with your project. Ask follow-up questions or provide additional guidance.
          </div>
        `;
      }
      
      // If this persona is currently active in main chat, update that too
      if (currentActivePersona === personaId) {
        const mainChatMessages = byId('chat-messages');
        mainChatMessages.innerHTML = `
          <div class="message system">
            <div class="message-header">System</div>
            Now chatting with ${personas[personaId].name}. Ask follow-up questions or provide additional guidance.
          </div>
        `;
      }
    }

    function renderToolbar() {
      const instC = byId('toolbar-instances');
      const taskC = byId('toolbar-tasks');
      instC.innerHTML = instances.map(inst => `<span class="toolbar-chip" data-inst="${inst.id}">${inst.name}</span>`).join('');
      taskC.innerHTML = tasks.map(t => `<span class="toolbar-chip" data-task="${t.id}">${t.title}</span>`).join('');
      instC.querySelectorAll('[data-inst]').forEach(chip => chip.addEventListener('click', () => {
        const inst = instances.find(i => i.id === chip.dataset.inst); if (inst) showPersonaView(inst.personaId);
      }));
      taskC.querySelectorAll('[data-task]').forEach(chip => chip.addEventListener('click', () => { showView('chat'); }));
    }

    function renderLinkedChips() {
      byId('linked-instances').innerHTML = instances.map(i => `<span class="chip">${i.name}</span>`).join('');
      byId('linked-tasks').innerHTML = tasks.map(t => `<span class="chip secondary">${t.title}</span>`).join('');
    }

    function showPersonaView(personaId) {
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      let view = byId(`${personaId}-persona-view`);
      if (!view) {
        // build view on first access
        const wrapper = document.createElement('div');
        wrapper.className = 'view persona-view';
        wrapper.id = `${personaId}-persona-view`;
        const p = personas[personaId];
        wrapper.innerHTML = `
          <div class="persona-header">
            <div class="persona-avatar" style="background:${p.color};">${p.shortName}</div>
                          <div class="persona-details">
                <h3>${p.name}</h3>
                <p>${p.description}</p>
              </div>
              <div class="persona-header-actions">
                <button class="action-btn" onclick="clearPersonaChat('${personaId}')" title="Clear this persona's chat">
                  <span>🗑️</span> Clear Chat
                </button>
              </div>
          </div>
          <div class="persona-content">
            <div class="chat-interface" style="margin-bottom: 24px;">
              <div class="chat-header" style="border-radius: 12px 12px 0 0;">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                  <h4 style="margin: 0; font-size: 0.875rem; font-weight: 600; color: #1d1d1f;">Follow-up Chat</h4>
                  <button class="action-btn" onclick="clearPersonaChat('${personaId}')" title="Clear chat history">
                    <span>🗑️</span> Clear
                  </button>
                </div>
              </div>
              <div class="chat-messages" id="${personaId}-chat-messages">
                <div class="message system">
                  <div class="message-header">System</div>
                  ${p.name} is ready to help with your project. Ask follow-up questions or provide additional guidance.
                </div>
              </div>
              <div class="input-section">
                <textarea id="${personaId}-input" placeholder="Ask ${p.name} a follow-up question..."></textarea>
                <button class="btn" onclick="sendPersonaMessage('${personaId}')">Send</button>
              </div>
            </div>
            <div class="persona-thinking">
              <h4>Current Status</h4>
              <div class="thinking-content" id="${personaId}-thinking">Ready to contribute to the project...</div>
            </div>
            <div id="${personaId}-dependencies"></div>
            <div class="deliverables-section">
              <h4>Deliverables</h4>
              <div id="${personaId}-deliverables"></div>
            </div>
          </div>`;
        byId('persona-views').appendChild(wrapper);
      }
      byId(`${personaId}-persona-view`).classList.add('active');
      byId('view-title').textContent = personas[personaId].name;
      updatePersonaView(personaId);
      currentView = `${personaId}-persona`;
    }

    function updatePersonaView(personaId) {
      const state = personaStates[personaId];
      const thinkEl = byId(`${personaId}-thinking`); if (thinkEl) thinkEl.textContent = state.thinking;
      const depC = byId(`${personaId}-dependencies`);
      if (depC) {
        depC.innerHTML = state.dependencies.length ? `<div class="persona-thinking" style="background:#FEF3C7;border-color:#F59E0B"><div style="font-weight:700;color:#92400e;margin-bottom:6px;">Waiting for</div><div style="color:#92400e;">${state.dependencies.join(', ')}</div></div>` : '';
      }
      renderDeliverables(personaId);
    }
    
    function renderDeliverables(personaId) {
      const container = byId(`${personaId}-deliverables`);
      if (!container) return;
      
      const deliverables = getPersonaDeliverables(personaId);
      container.innerHTML = deliverables.map(del => `
        <div class="deliverable-item" onclick="openDeliverable('${del.id}', '${del.title}', '${personaId}')">
          <h5>${del.title}</h5>
          <p>${del.description}</p>
        </div>
      `).join('');
    }
    
    function getPersonaDeliverables(personaId) {
      const deliverableMap = {
        'executive': [
          { id: 'vision-doc', title: 'Project Vision Document', description: 'Strategic objectives and high-level project goals' },
          { id: 'strategy-brief', title: 'Strategic Brief', description: 'Market positioning and competitive analysis' }
        ],
        'product-manager': [
          { id: 'market-research', title: 'Market Research Report', description: 'Competitor analysis and market opportunities' },
          { id: 'product-requirements', title: 'Product Requirements Document', description: 'Detailed functional and non-functional requirements' },
          { id: 'user-personas', title: 'User Personas', description: 'Target user profiles and behavior patterns' }
        ],
        'solution-architect': [
          { id: 'system-architecture', title: 'System Architecture Document', description: 'Technical specifications and implementation strategy' },
          { id: 'tech-stack', title: 'Technology Stack Recommendations', description: 'Recommended tools and frameworks for development' }
        ],
        'program-manager': [
          { id: 'project-timeline', title: 'Project Timeline', description: 'Detailed schedule with milestones and deadlines' },
          { id: 'task-breakdown', title: 'Task Breakdown Structure', description: 'Epics and user stories with acceptance criteria' }
        ],
        'design-buddy': [
          { id: 'user-journey', title: 'User Journey Maps', description: 'Detailed user flows and interaction patterns' },
          { id: 'wireframes', title: 'UI Wireframes', description: 'Visual mockups and design system components' }
        ]
      };
      return deliverableMap[personaId] || [];
    }
    
    function openDeliverable(deliverableId, title, personaId) {
      const modal = byId('deliverable-modal');
      const titleEl = byId('deliverable-title');
      const bodyEl = byId('deliverable-body');
      
      titleEl.textContent = title;
      bodyEl.innerHTML = generateDeliverableContent(deliverableId, personaId);
      modal.style.display = 'flex';
    }
    
    function closeDeliverableModal() {
      byId('deliverable-modal').style.display = 'none';
    }
    
    function generateDeliverableContent(deliverableId, personaId) {
      const sampleContent = {
        'vision-doc': `
          <h4>Executive Vision</h4>
          <p><strong>Project Objective:</strong> Create an innovative solution that addresses key market needs while maintaining competitive advantage.</p>
          
          <h4>Strategic Goals</h4>
          <ul>
            <li>Capture 15% market share within 18 months</li>
            <li>Achieve break-even by month 12</li>
            <li>Build scalable foundation for future growth</li>
          </ul>
          
          <h4>Success Metrics</h4>
          <p>Key performance indicators include user acquisition rate, revenue growth, and customer satisfaction scores.</p>
        `,
        'market-research': `
          <h4>Market Analysis</h4>
          <p><strong>Market Size:</strong> $2.4B total addressable market with 12% annual growth rate.</p>
          
          <h4>Competitive Landscape</h4>
          <ul>
            <li><strong>Competitor A:</strong> Strong in enterprise, weak in SMB</li>
            <li><strong>Competitor B:</strong> Good UX but limited features</li>
            <li><strong>Market Gap:</strong> No solution addresses both ease-of-use and enterprise features</li>
          </ul>
          
          <h4>Target Users</h4>
          <p>Primary: Small to medium businesses seeking enterprise-grade solutions<br>
          Secondary: Enterprise teams needing simplified workflows</p>
        `,
        'system-architecture': `
          <h4>System Overview</h4>
          <p><strong>Architecture Pattern:</strong> Microservices with event-driven communication</p>
          
          <h4>Technology Stack</h4>
          <ul>
            <li><strong>Frontend:</strong> React with TypeScript</li>
            <li><strong>Backend:</strong> Node.js with Express</li>
            <li><strong>Database:</strong> PostgreSQL with Redis cache</li>
            <li><strong>Infrastructure:</strong> AWS with Kubernetes</li>
          </ul>
          
          <h4>Scalability Considerations</h4>
          <p>Horizontal scaling capabilities, load balancing, and automated failover mechanisms.</p>
        `,
        'project-timeline': `
          <h4>Project Timeline</h4>
          <p><strong>Duration:</strong> 6 months with 3 major phases</p>
          
          <h4>Phase Breakdown</h4>
          <ul>
            <li><strong>Phase 1 (Months 1-2):</strong> Requirements and Design</li>
            <li><strong>Phase 2 (Months 3-4):</strong> Core Development</li>
            <li><strong>Phase 3 (Months 5-6):</strong> Testing and Launch</li>
          </ul>
          
          <h4>Key Milestones</h4>
          <p>MVP completion, beta testing, and production deployment milestones with clear success criteria.</p>
        `,
        'user-journey': `
          <h4>User Journey Analysis</h4>
          <p><strong>Primary User Flow:</strong> Discovery → Evaluation → Onboarding → Active Use</p>
          
          <h4>Key Touchpoints</h4>
          <ul>
            <li><strong>Landing Page:</strong> Clear value proposition</li>
            <li><strong>Sign-up Flow:</strong> Streamlined registration</li>
            <li><strong>First Use:</strong> Guided onboarding experience</li>
            <li><strong>Daily Use:</strong> Efficient workflow patterns</li>
          </ul>
          
          <h4>Pain Points & Solutions</h4>
          <p>Identified friction points in current solutions and proposed UX improvements.</p>
        `
      };
      
      return sampleContent[deliverableId] || `
        <h4>${personas[personaId].name} Deliverable</h4>
        <p>This deliverable contains detailed analysis and recommendations from your ${personas[personaId].name}.</p>
        <p><strong>Status:</strong> In Progress</p>
        <p><strong>Last Updated:</strong> ${new Date().toLocaleDateString()}</p>
        <p>Detailed content will be generated based on your project requirements and persona interactions.</p>
      `;
    }

    function updatePersonaStatus(personaId, status, thinking) {
      personaStates[personaId].status = status; personaStates[personaId].thinking = thinking;
      const st = byId(`${personaId}-status`); if (st) st.textContent = thinking.substring(0, 40) + '...';
      const ind = byId(`${personaId}-indicator`); if (ind) ind.className = `status-indicator status-${status}`;
      if (currentView === `${personaId}-persona`) updatePersonaView(personaId);
      updateProgressOverview();
    }

    function updateProgressOverview() {
      const section = byId('progress-overview-section');
      const container = byId('progress-overview');
      if (!selectedPersonas.length) { section.style.display = 'none'; return; }
      section.style.display = 'block'; container.innerHTML = '';
      selectedPersonas.forEach(pid => {
        const state = personaStates[pid];
        const card = document.createElement('div'); card.className = 'progress-card'; card.onclick = () => showPersonaView(pid);
        card.innerHTML = `
          <div class="progress-card-header">
            <div class="persona-avatar" style="background:${personas[pid].color};">${personas[pid].shortName}</div>
            <h4>${personas[pid].name}</h4>
            <div class="progress-percentage">${state.progress}%</div>
          </div>
          <div class="progress-bar"><div class="progress-fill" style="width:${state.progress}%"></div></div>
          <div class="status" style="margin-top: 10px; color: #6b7280; font-size: 0.9rem;">${state.thinking}</div>`;
        container.appendChild(card);
      })
    }

    function updateProjectSelector() {
      const selector = byId('project-selector');
      selector.innerHTML = '<option value="">Select Project...</option>';
      projects.forEach(project => {
        const option = document.createElement('option');
        option.value = project.id;
        option.textContent = project.name;
        if (currentProject && currentProject.id === project.id) {
          option.selected = true;
        }
        selector.appendChild(option);
      });
      selector.innerHTML += '<option value="new">+ New Project</option>';
    }

    function createNewProject() {
      const projectName = prompt('Enter project name:');
      if (!projectName) return;
      
      const project = {
        id: 'proj_' + Date.now(),
        name: projectName,
        personas: [],
        created: new Date().toISOString()
      };
      
      projects.push(project);
      currentProject = project;
      selectedPersonas = [];
      updateProjectSelector();
      showView('setup');
    }

    function switchProject(projectId) {
      if (projectId === 'new') {
        createNewProject();
        return;
      }
      
      const project = projects.find(p => p.id === projectId);
      if (project) {
        currentProject = project;
        selectedPersonas = [...project.personas];
        updateDashboardView();
        renderSelectedTeam();
        updateProgressOverview();
        renderSidebar();
      } else {
        currentProject = null;
        selectedPersonas = [];
        updateDashboardView();
      }
    }

    // Executive chat flow
    function submitExecutiveIdea() {
      const input = byId('executive-input'); 
      const idea = input.value.trim(); 
      if (!idea) return;
      
      // Handle broadcast mode
      if (broadcastMode) {
        addMessage('You', idea, 'user');
        input.value = '';
        broadcastMessage(idea);
        return;
      }
      
      // If we have an active persona (after workflow started), send to that persona
      if (currentActivePersona && currentView === 'overview') {
        sendPersonaMessage(currentActivePersona);
        return;
      }
      
      // Otherwise, handle as executive idea (initial submission in chat view)
      addMessage('You', idea, 'user'); 
      input.value = '';
      setTimeout(() => generateActionPlan(idea), 800);
    }

    function generateActionPlan(idea) {
      const plans = {
        'product-manager': 'Conduct market research, analyze competitors, define user personas, and create product requirements document',
        'solution-architect': 'Review requirements, design system architecture, create technical specs, and define implementation plan',
        'program-manager': 'Break down requirements into epics and stories, create project timeline, and set up task tracking',
        'design-buddy': 'Create user journey maps, design wireframes, develop UI mockups, and establish design system'
      };
      const tasksPlan = selectedPersonas.filter(p => p !== 'executive').map(pid => ({ persona: personas[pid].name, task: plans[pid] || 'Collaborate with team to support project goals' }));
      const html = `<p>Based on your idea: "${idea}", here's the execution plan:</p><ul>${tasksPlan.map(t => `<li><strong>${t.persona}:</strong> ${t.task}</li>`).join('')}</ul>`;
      byId('action-plan-content').innerHTML = html; byId('action-plan-section').style.display = 'block';
      addMessage('Executive AI', 'I\'ve analyzed your idea and created an action plan. Please review it below and give the green light when ready.');
    }

    function refineActionPlan() {
      addMessage('Executive AI', 'Please describe what you\'d like to change about the current plan, and I\'ll refine it accordingly.');
      byId('executive-input').placeholder = 'Describe changes to the action plan...';
    }

    function approveActionPlan() {
      addMessage('You', 'Action plan approved. Green light given to the team!', 'user');
      addMessage('Executive AI', 'Excellent! I\'m now delegating tasks to the team. Moving to execution phase.');
      setTimeout(() => { showView('overview'); startExecution(); }, 800);
    }

    // Execution orchestration
    function startExecution() {
      setupDependencies();
      updatePersonaStatus('executive', 'working', 'Creating project vision and strategic objectives...');
      if (selectedPersonas.includes('product-manager')) { updatePersonaStatus('product-manager', 'waiting', 'Waiting for executive vision before starting market research...'); personaStates['product-manager'].dependencies = ['Executive vision']; }
      if (selectedPersonas.includes('solution-architect')) { updatePersonaStatus('solution-architect', 'waiting', 'Waiting for product requirements to begin technical design...'); personaStates['solution-architect'].dependencies = ['Product requirements']; }
      if (selectedPersonas.includes('program-manager')) { updatePersonaStatus('program-manager', 'waiting', 'Waiting for technical specifications to create project plan...'); personaStates['program-manager'].dependencies = ['Technical specifications']; }
      if (selectedPersonas.includes('design-buddy')) { updatePersonaStatus('design-buddy', 'waiting', 'Waiting for product requirements to start design work...'); personaStates['design-buddy'].dependencies = ['Product requirements']; }
      simulateWorkflow();
    }

    function setupDependencies() {
      const deps = { executive: [], 'product-manager': ['executive'], 'solution-architect': ['product-manager'], 'program-manager': ['solution-architect'], 'design-buddy': ['product-manager'] };
      selectedPersonas.forEach(pid => { personaStates[pid].dependencies = (deps[pid] || []).map(d => personas[d]?.name).filter(Boolean); });
    }

    function simulateWorkflow() {
      simulatePersonaWork('executive', () => {
        if (selectedPersonas.includes('product-manager')) {
          personaStates['product-manager'].dependencies = []; updatePersonaStatus('product-manager','working','Conducting market research and defining requirements...');
          simulatePersonaWork('product-manager', () => {
            if (selectedPersonas.includes('solution-architect')) {
              personaStates['solution-architect'].dependencies = []; updatePersonaStatus('solution-architect','working','Creating technical architecture and system design...');
              simulatePersonaWork('solution-architect', () => {
                if (selectedPersonas.includes('program-manager')) {
                  personaStates['program-manager'].dependencies = []; updatePersonaStatus('program-manager','working','Creating project timeline and task breakdown...');
                  simulatePersonaWork('program-manager', () => { addMessage('System', 'All team members have completed their tasks! Project execution finished successfully.', 'system'); });
                }
              });
            }
            if (selectedPersonas.includes('design-buddy')) {
              personaStates['design-buddy'].dependencies = []; updatePersonaStatus('design-buddy','working','Creating user experience designs and wireframes...');
              simulatePersonaWork('design-buddy');
            }
          });
        }
      });
    }

    function simulatePersonaWork(personaId, onComplete) {
      if (workflowInterrupted) return;
      
      const steps = ['Starting analysis...', 'Gathering information...', 'Processing requirements...', 'Creating deliverables...', 'Finalizing work...', 'Task completed!'];
      let i = 0; 
      
      const tick = setInterval(() => {
        // Check if workflow was interrupted
        if (workflowInterrupted) {
          clearInterval(tick);
          delete workflowTimers[personaId];
          return;
        }
        
        const progress = (i + 1) * (100 / steps.length); 
        personaStates[personaId].progress = Math.round(progress);
        let thinking = steps[i]; 
        
        if (i === steps.length - 1) { 
          thinking = 'Task completed! Deliverables ready for review.'; 
          updatePersonaStatus(personaId,'complete',thinking); 
        } else { 
          updatePersonaStatus(personaId,'working',thinking); 
        }
        
        addMessage(personas[personaId].name, thinking, 'ai');
        i++; 
        
        if (i >= steps.length) { 
          clearInterval(tick); 
          delete workflowTimers[personaId];
          if (onComplete) onComplete(); 
        }
      }, 1200 + Math.random() * 1200);
      
      // Store timer for interruption capability
      workflowTimers[personaId] = tick;
    }

    // High-level actions
    function proceedToChat() {
      if (!selectedPersonas.length) return; 
      
      // Save project state
      if (currentProject) {
        currentProject.personas = [...selectedPersonas];
      }
      
      // Set first persona as active by default
      currentActivePersona = selectedPersonas[0];
      
      showView('chat');
      // Auto-create instances and tasks linked together
      instances.length = 0; tasks.length = 0;
      selectedPersonas.forEach((pid, idx) => {
        const instId = `${pid}-inst-${idx+1}`; instances.push({ id: instId, personaId: pid, name: `${personas[pid].name} ${idx+1}` });
        tasks.push({ id: `${pid}-task-${idx+1}`, personaId: pid, title: `${personas[pid].name} Chat` });
      });
      
      // Update input placeholder for active persona
      byId('executive-input').placeholder = `Describe your idea to ${personas[currentActivePersona].name}...`;
      
      renderToolbar(); renderLinkedChips(); renderSelectedTeam(); updateProgressOverview();
    }

    function resetChatMessages() {
      byId('chat-messages').innerHTML = `
        <div class="message system">
          <div class="message-header">System</div>
          Chat reset. ${currentActivePersona ? `Ready to chat with ${personas[currentActivePersona].name}.` : 'Team initialized. Ready to receive your executive idea.'}
        </div>
      `;
      
      // Clear individual persona chats too
      selectedPersonas.forEach(pid => {
        const personaChat = byId(`${pid}-chat-messages`);
        if (personaChat) {
          personaChat.innerHTML = `
            <div class="message system">
              <div class="message-header">System</div>
              ${personas[pid].name} is ready to help with your project.
            </div>
          `;
        }
      });
    }

    function resetWorkflow() {
      selectedPersonas = []; 
      currentProject = null;
      currentActivePersona = null;
      workflowInterrupted = false;
      
      // Clear all timers
      Object.keys(workflowTimers).forEach(timerId => {
        clearInterval(workflowTimers[timerId]);
        delete workflowTimers[timerId];
      });
      
      Object.keys(personas).forEach(id => { 
        personaStates[id] = { status: 'idle', thinking: 'Ready to contribute to the project...', progress: 0, dependencies: [], deliverables: [] }; 
        const st = byId(`${id}-status`); if (st) st.textContent = 'Ready to work'; 
        const ind = byId(`${id}-indicator`); if (ind) ind.className = 'status-indicator status-idle'; 
      });
      
      byId('chat-messages').innerHTML = '<div class="message system"><div class="message-header">System</div>Team initialized. Ready to receive your executive idea.</div>';
      byId('action-plan-section').style.display = 'none'; 
      byId('progress-overview-section').style.display = 'none';
      byId('interrupt-controls').style.display = 'none';
      byId('executive-input').placeholder = 'Describe your idea or project...'; 
      byId('executive-input').value = '';
      byId('proceed-to-chat').disabled = true; 
      instances.length = 0; tasks.length = 0; 
      renderToolbar(); renderLinkedChips();
      updateProjectSelector(); updateDashboardView(); renderSetupGrid(); showView('overview');
    }

    // Event wiring
    document.addEventListener('DOMContentLoaded', () => {
      // Top nav
      document.querySelectorAll('.nav-item').forEach(i => i.addEventListener('click', () => showView(i.dataset.view)));
      byId('btn-start-project').addEventListener('click', () => showView('setup'));
      byId('btn-update-team').addEventListener('click', () => showView('setup'));
      byId('btn-continue-chat').addEventListener('click', () => showView('chat'));

      // Project selector
      byId('project-selector').addEventListener('change', (e) => switchProject(e.target.value));

      // Setup actions
      renderSetupGrid(); renderSidebar();
      byId('proceed-to-chat').addEventListener('click', proceedToChat);

      // Chat actions
      byId('btn-send').addEventListener('click', submitExecutiveIdea);
      byId('btn-refine').addEventListener('click', refineActionPlan);
      byId('btn-approve').addEventListener('click', approveActionPlan);
      
      // New chat controls
      byId('btn-broadcast-mode').addEventListener('click', toggleBroadcastMode);
      byId('btn-interrupt').addEventListener('click', interruptWorkflow);
      byId('btn-reset-chat').addEventListener('click', () => {
        if (confirm('Are you sure you want to reset the chat? This will clear all messages.')) {
          resetChatMessages();
        }
      });

      // Modal close on background click
      byId('deliverable-modal').addEventListener('click', (e) => {
        if (e.target === byId('deliverable-modal')) closeDeliverableModal();
      });

      updateProjectSelector();
      updateDashboardView();
    });
  </script>
</body>
</html>