<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StartupSuite ‚Äì Executive Orchestration</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f7fa; min-height: 100vh; overflow-x: hidden; }
    .app-container { display: flex; min-height: 100vh; }

    /* Sidebar */
    .sidebar { width: 280px; background: white; border-right: 1px solid #e0e6ed; padding: 20px 0; overflow-y: auto; }
    .sidebar-header { padding: 0 20px 20px; border-bottom: 1px solid #e0e6ed; margin-bottom: 20px; }
    .sidebar-header h2 { font-size: 1.2rem; color: #1a1a1a; margin-bottom: 5px; }
    .sidebar-nav { padding: 0 10px; }
    .nav-item { display: flex; align-items: center; padding: 12px 15px; margin: 5px 0; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; color: #6b7280; font-size: 0.9rem; }
    .nav-item:hover { background: #f3f4f6; color: #374151; }
    .nav-item.active { background: #f0f4ff; color: #4f46e5; border-left: 3px solid #4f46e5; }

    .persona-list { margin-top: 20px; padding: 0 10px; }
    .persona-sidebar-item { display: flex; align-items: center; padding: 10px 15px; margin: 5px 0; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; position: relative; }
    .persona-sidebar-item:hover { background: #f9fafb; }
    .persona-sidebar-item.active { background: #f0f4ff; }
    .persona-avatar { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.8rem; margin-right: 12px; }
    .persona-info { flex: 1; }
    .persona-name { font-size: 0.9rem; font-weight: 500; color: #1f2937; margin-bottom: 2px; }
    .persona-status { font-size: 0.75rem; color: #6b7280; }
    .status-indicator { width: 8px; height: 8px; border-radius: 50%; position: absolute; top: 8px; right: 10px; }
    .status-working { background: #fbbf24; }
    .status-complete { background: #10b981; }
    .status-waiting { background: #ef4444; }
    .status-idle { background: #9ca3af; }

    /* Main */
    .main-content { flex: 1; display: flex; flex-direction: column; }
    .top-header { background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%); color: white; padding: 20px 30px; display: flex; align-items: center; justify-content: space-between; }
    .top-header h1 { font-size: 1.5rem; font-weight: 600; }
    .header-toolbar { display: flex; align-items: center; gap: 12px; }
    .toolbar-group { display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.25); padding: 6px 8px; border-radius: 10px; }
    .toolbar-label { font-size: 0.75rem; opacity: 0.95; }
    .toolbar-chips { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
    .toolbar-chip { background: rgba(255,255,255,0.22); color: white; border: 1px solid rgba(255,255,255,0.35); padding: 4px 10px; border-radius: 999px; font-size: 0.75rem; cursor: pointer; }
    .toolbar-chip:hover { background: rgba(255,255,255,0.32); }
    .header-btn { background: rgba(255, 255, 255, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); color: white; padding: 8px 16px; border-radius: 6px; font-size: 0.85rem; cursor: pointer; transition: all 0.2s ease; }
    .header-btn:hover { background: rgba(255, 255, 255, 0.3); }

    .content-area { flex: 1; padding: 30px; overflow-y: auto; }
    .view-container { background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); min-height: calc(100vh - 160px); }
    .view { display: none; padding: 30px; }
    .view.active { display: block; }

    .welcome-section { text-align: center; padding: 60px 40px; }
    .welcome-section h2 { color: #1f2937; font-size: 2rem; font-weight: 600; margin-bottom: 15px; }
    .welcome-section p { font-size: 1.1rem; color: #6b7280; margin-bottom: 20px; }

    .team-selection { margin: 40px 0; }
    .personas-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; margin: 20px 0; }
    .persona-card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; background: white; transition: all 0.2s ease; }
    .persona-card:hover { border-color: #8b5cf6; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(139, 92, 246, 0.15); }
    .persona-card.selected { border-color: #8b5cf6; background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(168, 85, 247, 0.05) 100%); }
    .persona-card h4 { color: #1f2937; font-size: 1.1rem; font-weight: 600; margin-bottom: 6px; }
    .persona-card p { color: #6b7280; font-size: 0.9rem; line-height: 1.5; }

    .btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 22px; border-radius: 10px; font-size: 0.95rem; cursor: pointer; transition: all 0.3s ease; font-weight: 600; }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3); }
    .btn:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
    .btn-secondary { background: #6c757d; }
    .btn-success { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); }

    /* Progress */
    .progress-overview { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 10px 0 30px; }
    .progress-card { background: white; border: 1px solid #e5e7eb; border-radius: 12px; padding: 18px; cursor: pointer; transition: all 0.2s ease; position: relative; }
    .progress-card:hover { border-color: #8b5cf6; box-shadow: 0 4px 12px rgba(139, 92, 246, 0.1); }
    .progress-card-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
    .progress-card h4 { color: #1f2937; font-size: 1rem; font-weight: 600; margin: 0; }
    .progress-percentage { color: #6b7280; font-size: 0.9rem; margin-left: auto; }
    .progress-bar { background: #e1e5e9; height: 8px; border-radius: 4px; overflow: hidden; }
    .progress-fill { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 100%; transition: width 0.3s ease; }

    /* Chat */
    .chat-interface { background: #f8f9fa; border-radius: 15px; padding: 24px; margin: 10px 0 30px; }
    .team-info { background: #e3f2fd; border-radius: 10px; padding: 16px; margin-bottom: 16px; }
    .team-info h4 { color: #1976d2; margin-bottom: 8px; }
    .chip-row { display: flex; gap: 8px; flex-wrap: wrap; }
    .chip { background: #1976d2; color: white; padding: 4px 10px; border-radius: 999px; font-size: 0.8rem; cursor: pointer; }
    .chip.secondary { background: #6b7280; }
    .chat-messages { max-height: 420px; overflow-y: auto; background: white; border-radius: 10px; padding: 16px; margin: 16px 0; border: 1px solid #e1e5e9; }
    .message { margin-bottom: 16px; padding: 12px; border-radius: 10px; }
    .message.user { background: #e3f2fd; margin-left: 50px; }
    .message.ai { background: #f3e5f5; margin-right: 50px; }
    .message.system { background: #e8f5e8; text-align: center; font-style: italic; }
    .message-header { font-weight: 700; margin-bottom: 6px; color: #333; }
    .input-section { display: flex; gap: 12px; margin-top: 10px; }
    .input-section textarea { flex: 1; padding: 12px; border: 2px solid #e1e5e9; border-radius: 10px; font-family: inherit; font-size: 1rem; resize: vertical; min-height: 60px; }
    .input-section textarea:focus { outline: none; border-color: #667eea; }

    /* Persona individual */
    .persona-view { padding: 0; }
    .persona-header { background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); padding: 20px 24px; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; gap: 12px; }
    .persona-header .persona-avatar { width: 44px; height: 44px; font-size: 1.1rem; }
    .persona-details h3 { color: #1f2937; font-size: 1.15rem; font-weight: 600; margin-bottom: 4px; }
    .persona-details p { color: #6b7280; font-size: 0.9rem; }
    .persona-content { padding: 24px; }
    .persona-thinking { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 16px; margin-bottom: 18px; }
    .persona-thinking h4 { color: #475569; font-size: 0.85rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.03em; margin-bottom: 8px; }
    .thinking-content { color: #334155; line-height: 1.6; font-size: 0.95rem; }
    .deliverables-section { margin-top: 18px; }
    .deliverables-section h4 { color: #1f2937; font-size: 1rem; font-weight: 700; margin-bottom: 10px; }
    .deliverable-item { background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 14px; margin-bottom: 10px; }
    .deliverable-item h5 { color: #374151; font-size: 0.95rem; font-weight: 700; margin-bottom: 6px; }
    .deliverable-item p { color: #6b7280; font-size: 0.9rem; line-height: 1.5; }

    @media (max-width: 768px) {
      .personas-grid { grid-template-columns: 1fr; }
      .input-section { flex-direction: column; }
      .message.user { margin-left: 20px; }
      .message.ai { margin-right: 20px; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h2>StartupSuite</h2>
        <p style="color: #6b7280; font-size: 0.8rem;">Personas</p>
      </div>
      <div class="sidebar-nav">
        <div class="nav-item active" data-view="overview">üìä Team Overview</div>
        <div class="nav-item" data-view="setup">‚öôÔ∏è Team Setup</div>
        <div class="nav-item" data-view="chat">üí¨ Executive Chat</div>
      </div>
      <div class="persona-list" id="persona-sidebar"></div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="top-header">
        <h1 id="view-title">Team Overview</h1>
        <div class="header-toolbar">
          <div class="toolbar-group">
            <span class="toolbar-label">Instances</span>
            <div class="toolbar-chips" id="toolbar-instances"></div>
          </div>
          <div class="toolbar-group">
            <span class="toolbar-label">Tasks</span>
            <div class="toolbar-chips" id="toolbar-tasks"></div>
          </div>
          <div style="flex:1 1 auto"></div>
          <button class="header-btn" id="btn-new">New Project</button>
          <button class="header-btn" id="btn-setup">Settings</button>
        </div>
      </div>

      <div class="content-area">
        <div class="view-container">
          <!-- Overview -->
          <div class="view active" id="overview-view">
            <div class="welcome-section">
              <h2>Welcome to Your AI Team!</h2>
              <p>Your team is ready to work. What's on your mind?</p>
              <div style="text-align:center; margin-top: 20px;">
                <button class="btn" id="btn-start-project">Start New Project</button>
              </div>
            </div>
            <div id="progress-overview-section" style="display:none;">
              <h3 style="color:#1f2937; margin-bottom: 10px;">Project Progress</h3>
              <div class="progress-overview" id="progress-overview"></div>
            </div>
          </div>

          <!-- Setup -->
          <div class="view" id="setup-view">
            <div class="team-selection">
              <h3 style="text-align:center;">Choose Your Team</h3>
              <p style="text-align:center; color:#6b7280; margin-bottom: 20px;">Select the AI personas you want on your team:</p>
              <div class="personas-grid" id="setup-personas-grid"></div>
              <div style="text-align:center; margin-top: 20px;">
                <button class="btn" id="proceed-to-chat" disabled>Start Working</button>
              </div>
            </div>
          </div>

          <!-- Executive Chat -->
          <div class="view" id="chat-view">
            <div class="chat-interface">
              <div class="team-info" id="team-info">
                <h4>Selected Team</h4>
                <div class="chip-row" id="selected-team-chips"></div>
                <div style="height:8px"></div>
                <div class="chip-row" id="linked-instances"></div>
                <div class="chip-row" id="linked-tasks" style="margin-top:6px"></div>
              </div>
              <div class="chat-messages" id="chat-messages">
                <div class="message system"><div class="message-header">System</div>Team initialized. Ready to receive your executive idea.</div>
              </div>
              <div class="input-section">
                <textarea id="executive-input" placeholder="Describe your idea or project..."></textarea>
                <button class="btn" id="btn-send">Send</button>
              </div>
              <div id="action-plan-section" style="display:none;">
                <div class="action-plan" style="background:#fff3cd; border:1px solid #ffeaa7; border-radius:10px; padding:16px; margin: 16px 0;">
                  <h4 style="color:#856404; margin-bottom:8px;">Executive Action Plan</h4>
                  <div id="action-plan-content"></div>
                  <div style="text-align:center; margin-top: 10px;">
                    <button class="btn btn-secondary" id="btn-refine">Refine Plan</button>
                    <button class="btn btn-success" id="btn-approve">Give Green Light</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Persona detail views -->
          <div id="persona-views"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Personas configuration
    const personas = {
      'executive': { name: 'Executive', description: 'Strategic vision and oversight', color: 'linear-gradient(135deg, #8b5cf6, #7c3aed)', shortName: 'EX' },
      'product-manager': { name: 'Product Manager', description: 'Market research and requirements', color: 'linear-gradient(135deg, #06b6d4, #0891b2)', shortName: 'PM' },
      'solution-architect': { name: 'Solution Architect', description: 'Technical design and architecture', color: 'linear-gradient(135deg, #10b981, #059669)', shortName: 'SA' },
      'program-manager': { name: 'Program Manager', description: 'Project planning and task management', color: 'linear-gradient(135deg, #f59e0b, #d97706)', shortName: 'PGM' },
      'design-buddy': { name: 'Design Buddy', description: 'User experience and design', color: 'linear-gradient(135deg, #ec4899, #db2777)', shortName: 'DB' }
    };

    // State
    let selectedPersonas = [];
    let currentView = 'overview';
    const personaStates = {};
    const instances = []; // {id, personaId, name}
    const tasks = []; // {id, personaId, title}

    Object.keys(personas).forEach(id => {
      personaStates[id] = { status: 'idle', thinking: 'Ready to contribute to the project...', progress: 0, dependencies: [], deliverables: [] };
    });

    // Utilities
    function byId(id) { return document.getElementById(id); }
    function addMessage(sender, content, type='ai') {
      const chatMessages = byId('chat-messages');
      const message = document.createElement('div');
      message.className = `message ${type}`;
      message.innerHTML = `<div class="message-header">${sender}</div>${content}`;
      chatMessages.appendChild(message); chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Views
    function showView(view) {
      document.querySelectorAll('.nav-item').forEach(i => i.classList.toggle('active', i.dataset.view === view));
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      if (view === 'overview') { byId('overview-view').classList.add('active'); byId('view-title').textContent = 'Team Overview'; }
      if (view === 'setup') { byId('setup-view').classList.add('active'); byId('view-title').textContent = 'Team Setup'; renderSetupGrid(); }
      if (view === 'chat') { byId('chat-view').classList.add('active'); byId('view-title').textContent = 'Executive Chat'; renderSelectedTeam(); }
      currentView = view;
    }

    function renderSidebar() {
      const container = byId('persona-sidebar');
      container.innerHTML = Object.keys(personas).map(pid => {
        const p = personas[pid];
        return `
          <div class="persona-sidebar-item" data-persona="${pid}">
            <div class="persona-avatar" style="background:${p.color};">${p.shortName}</div>
            <div class="persona-info">
              <div class="persona-name">${p.name}</div>
              <div class="persona-status" id="${pid}-status">Ready to work</div>
            </div>
            <div class="status-indicator status-idle" id="${pid}-indicator"></div>
          </div>`;
      }).join('');
      container.querySelectorAll('.persona-sidebar-item').forEach(el => {
        el.addEventListener('click', () => {
          const personaId = el.dataset.persona; showPersonaView(personaId);
        })
      })
    }

    function renderSetupGrid() {
      const grid = byId('setup-personas-grid');
      grid.innerHTML = Object.keys(personas).map(pid => {
        const p = personas[pid];
        return `
          <div class="persona-card" data-persona="${pid}">
            <div class="persona-avatar" style="background:${p.color}; width:48px; height:48px; margin:0 auto 10px; font-size:1.1rem;">${p.shortName}</div>
            <h4>${p.name}</h4>
            <p>${p.description}</p>
          </div>`;
      }).join('');
      grid.querySelectorAll('.persona-card').forEach(card => {
        card.addEventListener('click', () => {
          const pid = card.dataset.persona;
          const idx = selectedPersonas.indexOf(pid);
          if (idx > -1) { selectedPersonas.splice(idx, 1); card.classList.remove('selected'); }
          else { selectedPersonas.push(pid); card.classList.add('selected'); }
          byId('proceed-to-chat').disabled = selectedPersonas.length === 0;
        })
      })
    }

    function renderSelectedTeam() {
      byId('selected-team-chips').innerHTML = selectedPersonas.map(pid => `<span class="chip" style="background:#667eea">${personas[pid].name}</span>`).join('');
      renderToolbar();
      renderLinkedChips();
    }

    function renderToolbar() {
      const instC = byId('toolbar-instances');
      const taskC = byId('toolbar-tasks');
      instC.innerHTML = instances.map(inst => `<span class="toolbar-chip" data-inst="${inst.id}">${inst.name}</span>`).join('');
      taskC.innerHTML = tasks.map(t => `<span class="toolbar-chip" data-task="${t.id}">${t.title}</span>`).join('');
      instC.querySelectorAll('[data-inst]').forEach(chip => chip.addEventListener('click', () => {
        const inst = instances.find(i => i.id === chip.dataset.inst); if (inst) showPersonaView(inst.personaId);
      }));
      taskC.querySelectorAll('[data-task]').forEach(chip => chip.addEventListener('click', () => { showView('chat'); }));
    }

    function renderLinkedChips() {
      byId('linked-instances').innerHTML = instances.map(i => `<span class="chip">${i.name}</span>`).join('');
      byId('linked-tasks').innerHTML = tasks.map(t => `<span class="chip secondary">${t.title}</span>`).join('');
    }

    function showPersonaView(personaId) {
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      let view = byId(`${personaId}-persona-view`);
      if (!view) {
        // build view on first access
        const wrapper = document.createElement('div');
        wrapper.className = 'view persona-view';
        wrapper.id = `${personaId}-persona-view`;
        const p = personas[personaId];
        wrapper.innerHTML = `
          <div class="persona-header">
            <div class="persona-avatar" style="background:${p.color};">${p.shortName}</div>
            <div class="persona-details"><h3>${p.name}</h3><p>${p.description}</p></div>
          </div>
          <div class="persona-content">
            <div class="persona-thinking">
              <h4>Current Thinking</h4>
              <div class="thinking-content" id="${personaId}-thinking">Ready to contribute to the project...</div>
            </div>
            <div id="${personaId}-dependencies"></div>
            <div class="deliverables-section">
              <h4>Deliverables</h4>
              <div id="${personaId}-deliverables"></div>
            </div>
          </div>`;
        byId('persona-views').appendChild(wrapper);
      }
      byId(`${personaId}-persona-view`).classList.add('active');
      byId('view-title').textContent = personas[personaId].name;
      updatePersonaView(personaId);
      currentView = `${personaId}-persona`;
    }

    function updatePersonaView(personaId) {
      const state = personaStates[personaId];
      const thinkEl = byId(`${personaId}-thinking`); if (thinkEl) thinkEl.textContent = state.thinking;
      const depC = byId(`${personaId}-dependencies`);
      if (depC) {
        depC.innerHTML = state.dependencies.length ? `<div class="persona-thinking" style="background:#FEF3C7;border-color:#F59E0B"><div style="font-weight:700;color:#92400e;margin-bottom:6px;">Waiting for</div><div style="color:#92400e;">${state.dependencies.join(', ')}</div></div>` : '';
      }
    }

    function updatePersonaStatus(personaId, status, thinking) {
      personaStates[personaId].status = status; personaStates[personaId].thinking = thinking;
      const st = byId(`${personaId}-status`); if (st) st.textContent = thinking.substring(0, 40) + '...';
      const ind = byId(`${personaId}-indicator`); if (ind) ind.className = `status-indicator status-${status}`;
      if (currentView === `${personaId}-persona`) updatePersonaView(personaId);
      updateProgressOverview();
    }

    function updateProgressOverview() {
      const section = byId('progress-overview-section');
      const container = byId('progress-overview');
      if (!selectedPersonas.length) { section.style.display = 'none'; return; }
      section.style.display = 'block'; container.innerHTML = '';
      selectedPersonas.forEach(pid => {
        const state = personaStates[pid];
        const card = document.createElement('div'); card.className = 'progress-card'; card.onclick = () => showPersonaView(pid);
        card.innerHTML = `
          <div class="progress-card-header">
            <div class="persona-avatar" style="background:${personas[pid].color};">${personas[pid].shortName}</div>
            <h4>${personas[pid].name}</h4>
            <div class="progress-percentage">${state.progress}%</div>
          </div>
          <div class="progress-bar"><div class="progress-fill" style="width:${state.progress}%"></div></div>
          <div class="status" style="margin-top: 10px; color: #6b7280; font-size: 0.9rem;">${state.thinking}</div>`;
        container.appendChild(card);
      })
    }

    // Executive chat flow
    function submitExecutiveIdea() {
      const input = byId('executive-input'); const idea = input.value.trim(); if (!idea) return;
      addMessage('You', idea, 'user'); input.value = '';
      setTimeout(() => generateActionPlan(idea), 800);
    }

    function generateActionPlan(idea) {
      const plans = {
        'product-manager': 'Conduct market research, analyze competitors, define user personas, and create product requirements document',
        'solution-architect': 'Review requirements, design system architecture, create technical specs, and define implementation plan',
        'program-manager': 'Break down requirements into epics and stories, create project timeline, and set up task tracking',
        'design-buddy': 'Create user journey maps, design wireframes, develop UI mockups, and establish design system'
      };
      const tasksPlan = selectedPersonas.filter(p => p !== 'executive').map(pid => ({ persona: personas[pid].name, task: plans[pid] || 'Collaborate with team to support project goals' }));
      const html = `<p>Based on your idea: "${idea}", here's the execution plan:</p><ul>${tasksPlan.map(t => `<li><strong>${t.persona}:</strong> ${t.task}</li>`).join('')}</ul>`;
      byId('action-plan-content').innerHTML = html; byId('action-plan-section').style.display = 'block';
      addMessage('Executive AI', 'I\'ve analyzed your idea and created an action plan. Please review it below and give the green light when ready.');
    }

    function refineActionPlan() {
      addMessage('Executive AI', 'Please describe what you\'d like to change about the current plan, and I\'ll refine it accordingly.');
      byId('executive-input').placeholder = 'Describe changes to the action plan...';
    }

    function approveActionPlan() {
      addMessage('You', 'Action plan approved. Green light given to the team!', 'user');
      addMessage('Executive AI', 'Excellent! I\'m now delegating tasks to the team. Moving to execution phase.');
      setTimeout(() => { showView('overview'); startExecution(); }, 800);
    }

    // Execution orchestration
    function startExecution() {
      setupDependencies();
      updatePersonaStatus('executive', 'working', 'Creating project vision and strategic objectives...');
      if (selectedPersonas.includes('product-manager')) { updatePersonaStatus('product-manager', 'waiting', 'Waiting for executive vision before starting market research...'); personaStates['product-manager'].dependencies = ['Executive vision']; }
      if (selectedPersonas.includes('solution-architect')) { updatePersonaStatus('solution-architect', 'waiting', 'Waiting for product requirements to begin technical design...'); personaStates['solution-architect'].dependencies = ['Product requirements']; }
      if (selectedPersonas.includes('program-manager')) { updatePersonaStatus('program-manager', 'waiting', 'Waiting for technical specifications to create project plan...'); personaStates['program-manager'].dependencies = ['Technical specifications']; }
      if (selectedPersonas.includes('design-buddy')) { updatePersonaStatus('design-buddy', 'waiting', 'Waiting for product requirements to start design work...'); personaStates['design-buddy'].dependencies = ['Product requirements']; }
      simulateWorkflow();
    }

    function setupDependencies() {
      const deps = { executive: [], 'product-manager': ['executive'], 'solution-architect': ['product-manager'], 'program-manager': ['solution-architect'], 'design-buddy': ['product-manager'] };
      selectedPersonas.forEach(pid => { personaStates[pid].dependencies = (deps[pid] || []).map(d => personas[d]?.name).filter(Boolean); });
    }

    function simulateWorkflow() {
      simulatePersonaWork('executive', () => {
        if (selectedPersonas.includes('product-manager')) {
          personaStates['product-manager'].dependencies = []; updatePersonaStatus('product-manager','working','Conducting market research and defining requirements...');
          simulatePersonaWork('product-manager', () => {
            if (selectedPersonas.includes('solution-architect')) {
              personaStates['solution-architect'].dependencies = []; updatePersonaStatus('solution-architect','working','Creating technical architecture and system design...');
              simulatePersonaWork('solution-architect', () => {
                if (selectedPersonas.includes('program-manager')) {
                  personaStates['program-manager'].dependencies = []; updatePersonaStatus('program-manager','working','Creating project timeline and task breakdown...');
                  simulatePersonaWork('program-manager', () => { addMessage('System', 'All team members have completed their tasks! Project execution finished successfully.', 'system'); });
                }
              });
            }
            if (selectedPersonas.includes('design-buddy')) {
              personaStates['design-buddy'].dependencies = []; updatePersonaStatus('design-buddy','working','Creating user experience designs and wireframes...');
              simulatePersonaWork('design-buddy');
            }
          });
        }
      });
    }

    function simulatePersonaWork(personaId, onComplete) {
      const steps = ['Starting analysis...', 'Gathering information...', 'Processing requirements...', 'Creating deliverables...', 'Finalizing work...', 'Task completed!'];
      let i = 0; const tick = setInterval(() => {
        const progress = (i + 1) * (100 / steps.length); personaStates[personaId].progress = Math.round(progress);
        let thinking = steps[i]; if (i === steps.length - 1) { thinking = 'Task completed! Deliverables ready for review.'; updatePersonaStatus(personaId,'complete',thinking); } else { updatePersonaStatus(personaId,'working',thinking); }
        addMessage(personas[personaId].name, thinking, 'ai');
        i++; if (i >= steps.length) { clearInterval(tick); if (onComplete) onComplete(); }
      }, 1200 + Math.random() * 1200);
    }

    // High-level actions
    function proceedToChat() {
      if (!selectedPersonas.length) return; showView('chat');
      // Auto-create instances and tasks linked together
      instances.length = 0; tasks.length = 0;
      selectedPersonas.forEach((pid, idx) => {
        const instId = `${pid}-inst-${idx+1}`; instances.push({ id: instId, personaId: pid, name: `${personas[pid].name} ${idx+1}` });
        tasks.push({ id: `${pid}-task-${idx+1}`, personaId: pid, title: `${personas[pid].name} Chat` });
      });
      renderToolbar(); renderLinkedChips(); renderSelectedTeam(); updateProgressOverview();
    }

    function resetWorkflow() {
      selectedPersonas = []; Object.keys(personas).forEach(id => { personaStates[id] = { status: 'idle', thinking: 'Ready to contribute to the project...', progress: 0, dependencies: [], deliverables: [] }; const st = byId(`${id}-status`); if (st) st.textContent = 'Ready to work'; const ind = byId(`${id}-indicator`); if (ind) ind.className = 'status-indicator status-idle'; });
      byId('chat-messages').innerHTML = '<div class="message system"><div class="message-header">System</div>Team initialized. Ready to receive your executive idea.</div>';
      byId('action-plan-section').style.display = 'none'; byId('progress-overview-section').style.display = 'none';
      byId('executive-input').placeholder = 'Describe your idea or project...'; byId('executive-input').value = '';
      byId('proceed-to-chat').disabled = true; instances.length = 0; tasks.length = 0; renderToolbar(); renderLinkedChips();
      renderSetupGrid(); showView('overview');
    }

    // Event wiring
    document.addEventListener('DOMContentLoaded', () => {
      // Top nav
      document.querySelectorAll('.nav-item').forEach(i => i.addEventListener('click', () => showView(i.dataset.view)));
      byId('btn-setup').addEventListener('click', () => showView('setup'));
      byId('btn-new').addEventListener('click', resetWorkflow);
      byId('btn-start-project').addEventListener('click', () => showView('setup'));

      // Setup actions
      renderSetupGrid(); renderSidebar();
      byId('proceed-to-chat').addEventListener('click', proceedToChat);

      // Chat actions
      byId('btn-send').addEventListener('click', submitExecutiveIdea);
      byId('btn-refine').addEventListener('click', refineActionPlan);
      byId('btn-approve').addEventListener('click', approveActionPlan);

      updateProgressOverview();
    });
  </script>
</body>
</html>